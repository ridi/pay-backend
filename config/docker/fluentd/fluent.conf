<source>
  @type forward
</source>

<match *.ridi-pay.backend.api>
  @type rewrite_tag_filter
  <rule>
    key log
    pattern /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>(?:[^\"]|\\.)*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>(?:[^\"]|\\.)*)" "(?<agent>(?:[^\"]|\\.)*)")?$/
    tag *.ridi-pay.backend.api.apache.access
  </rule>
  <rule>
    key log
    pattern /^\[[^ ]* (?<time>[^\]]*)\] \[(?<level>[^\]]*)\](?: \[pid (?<pid>[^\]]*)\])?( \[client (?<client>[^\]]*)\])? (?<message>.*)$/
    tag *.ridi-pay.backend.api.apache.error
  </rule>
  <rule>
    key log
    pattern /([0-9]+)-([0-9]+)\.([0-9]+)(\s+)-(\s+)([0-9]+)(\s+)-(\s+)(.+)(\s+)-(\s+)MSG(\s+):(\s+)(?<message>.*)/
    tag *.ridi-pay.backend.api.pg.kcp
  </rule>
</match>

<match **>
  @type cloudwatch_logs
  use_tag_as_group true
  auto_create_stream true
</match>
