version: "3"

services:
  api:
    image: 023315198496.dkr.ecr.ap-northeast-2.amazonaws.com/ridi/pay-backend:${GIT_REVISION}
    container_name: api
    build: .
    ports:
      - 80
    environment:
      - APP_ENV=${APP_ENV}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - GIT_REVISION=${GIT_REVISION}
    logging:
      driver: fluentd
      options:
        tag: ${APP_ENV}.ridi-pay.backend.api
    depends_on:
      - logger
  logger:
    image: 023315198496.dkr.ecr.ap-northeast-2.amazonaws.com/ridi/pay-logger:latest
    container_name: logger
    build: ./config/docker/fluentd
    ports:
      - 24224:24224
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=ap-northeast-2
